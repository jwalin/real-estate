<?phpclass company extends My_Controller {    public function __construct() {        parent::__construct();        $this->load->library('upload');        $this->load->library('image_lib');    }    public function index() {        $this->load->view('include/header_new');        $this->load->view('include/sidebar_new');        $data['data'] = $this->company_model->get_company_user();        $this->load->view('company', $data);        $this->load->view('include/footer_new');    }    public function add() {        $this->load->view('include/header_new');        $this->load->view('include/sidebar_new');        $this->load->view('company_add');        $this->load->view('include/footer_new');    }    public function edit($id) {        $this->load->view('include/header_new');        $this->load->view('include/sidebar_new');        $data['data_row'] = $this->company_model->get_company_user_by_id($id);        $this->load->view('company_edit', $data);        $this->load->view('include/footer_new');    }    public function insert() {        $company_logo = "";        if (!empty($_FILES['company_logo']['name'])) {            $img = $_FILES["company_logo"]['name'];            $ext = pathinfo($img, PATHINFO_EXTENSION);            $config['upload_path'] = '../upload/company_logo/';            $config['allowed_types'] = 'jpg|jpeg|png|gif';            $company_logo = time() . '.' . $ext;            $config['file_name'] = $company_logo;            $this->upload->initialize($config);            if ($this->upload->do_upload('company_logo')) {                $this->upload->data();            }        }        $data_company = array(            'company_name' => $this->input->post('company_name'),            'company_logo' => IMG_UPLOAD_PATH . 'company_logo/' . $company_logo,            'status' => $this->input->post('status'),            'created_by' => $this->sess_id,            'created_date' => $this->current_date()        );        $last_id = $this->company_model->company_insert($data_company);        $data = array(            'company_id' => $last_id,            'name' => $this->input->post('name'),            'email' => $this->input->post('email'),            'password' => md5($this->input->post('password')),            'created_by' => $this->sess_id,            'created_date' => $this->current_date()        );        $res = $this->company_model->insert($data);        $data_analytics = array(            'company_id' => $last_id,            'created_by' => $this->sess_id,            'created_date' => $this->current_date()        );        $res_analytics = $this->company_model->analytics_insert($data_analytics);        $email = $this->input->post('email');        $url = USER_LOGIN_LINK;        $toRepArray = array('[!email!]', '[!url!]', '[!img!]', '[!password!]');        $fromRepArray = array(            $this->input->post('email'),            $url,            LOGO_IMG,            $this->input->post('password')        );        $subject = "Your credential Detail";        $message_templete = $this->load->view('email/credential_detail.html', '', true);        $message = str_replace($toRepArray, $fromRepArray, $message_templete);        $sentmail = $this->send_email($email, $subject, $message);        if ($sentmail) {            $this->history_request();            $this->session->set_flashdata('success', RECORD_ADDED);        } else {            $this->session->set_flashdata('error', ERR_DATA_PROCESSING_ERROR);        }        redirect('company/');    }    public function update() {        $id = $this->input->post('id');        $company_id = $this->input->post('company_id');        if (!empty($_FILES['company_logo']['name'])) {            $img = $_FILES["company_logo"]['name'];            $ext = pathinfo($img, PATHINFO_EXTENSION);            $config['upload_path'] = '../upload/company_logo/';            $config['allowed_types'] = 'jpg|jpeg|png|gif';            $company_logo = time() . '.' . $ext;            $config['file_name'] = $company_logo;            $this->upload->initialize($config);            if ($this->upload->do_upload('company_logo')) {                $this->upload->data();            }            $up_logo = IMG_UPLOAD_PATH . 'company_logo/' . $company_logo;            $explode = explode('company_logo/', $this->input->post('company_logo_old'));            @unlink('../upload/company_logo/' . $explode[1]);        } else {            $up_logo = $this->input->post('company_logo_old');        }        $data_company = array(            'company_name' => $this->input->post('company_name'),            'company_logo' => $up_logo,            'status' => $this->input->post('status'),            'updated_by' => $this->sess_id,            'updated_date' => $this->current_date()        );        $res_company = $this->company_model->company_update($data_company, $company_id);        if ($res_company) {            $this->history_request();            $this->session->set_flashdata('success', RECORD_UPDATED);        } else {            $this->session->set_flashdata('error', ERR_DATA_PROCESSING_ERROR);        }        redirect('company/');    }    public function delete($id) {        $res_company = $this->company_model->company_delete($id);        $res = $this->company_model->delete($id);        if ($res) {            $this->history_request($id);            $this->session->set_flashdata('success', RECORD_DELETED);        } else {            $this->session->set_flashdata('error', ERR_DATA_PROCESSING_ERROR);        }        redirect('company/');    }    public function check_user_email() {        $email = $this->input->post('email');        echo $this->company_model->check_user_email($email);    }}?>